[{"id":"a9caf749.eb5048","type":"tab","label":"API","disabled":false,"info":""},{"id":"cc93ff07.e64b2","type":"tab","label":"VicEmergency","disabled":false,"info":""},{"id":"c062f1c4.9c61","type":"tab","label":"CFA","disabled":false,"info":""},{"id":"b04549c7.7fcce8","type":"tab","label":"BoM","disabled":true,"info":""},{"id":"96f4fbb4.ccf1f8","type":"tab","label":"MODIS","disabled":true,"info":""},{"id":"164e0840.391e68","type":"tab","label":"Flow 4","disabled":true,"info":""},{"id":"17e2e8ac.896147","type":"dropbox-config","z":""},{"id":"617678.b507e988","type":"ftp","z":"","host":"bom.gov.au","port":"","secureOptions":"","user":"","connTimeout":"","pasvTimeout":"","keepalive":""},{"id":"671e12d5.6bd4fc","type":"mongodb2","z":"","uri":"mongodb://localhost:27017/","name":"","options":"","parallelism":"-1"},{"id":"bdb0f5ea.af8508","type":"mongodb","hostname":"127.0.0.1","port":"27017","db":"1","name":""},{"id":"43dbd97c.b673e8","type":"postgresdb","z":"","hostname":"localhost","port":"5432","db":"postgres","ssl":false},{"id":"d2b70e2e.911d","type":"ftp","z":"","host":"nrt3.modaps.eosdis.nasa.gov","port":"","secureOptions":"","user":"anthonyrawlinsuom","connTimeout":"","pasvTimeout":"","keepalive":""},{"id":"4518fe2.7ae9d","type":"debug","z":"a9caf749.eb5048","name":"","active":false,"console":"false","complete":"true","x":818,"y":112,"wires":[]},{"id":"386edb7c.509784","type":"http response","z":"a9caf749.eb5048","name":"","statusCode":"","headers":{},"x":821,"y":197,"wires":[]},{"id":"a0163c0d.096a7","type":"function","z":"a9caf749.eb5048","name":"","func":"var fields = msg.req.files;\nmsg.fields = Object.keys(fields);\nvar myFile = fields[\"file\"][0];\n\nmsg.test = myFile;\nvar response = {};\n\nif(msg.test) {\n    response.statusCode=0;\n    response.localFilenamePath=myFile.path;\n    response.fileSize = myFile.size;\n    response.sendMessage=\"Successful\";\n} else {\n    response.statusCode=1;\n    response.sendMessage=\"Failed\";\n}\nmsg.payload = response;\n\nreturn msg;","outputs":"2","noerr":0,"x":455,"y":193,"wires":[["4518fe2.7ae9d","386edb7c.509784"],[]]},{"id":"f7682791.2c6fe8","type":"httpInMultipart","z":"a9caf749.eb5048","name":"","url":"/upload","method":"post","fields":"[{\"name\":\"file\"}]","swaggerDoc":"","x":130,"y":133,"wires":[["a0163c0d.096a7"]]},{"id":"52436c9f.c3ce04","type":"function","z":"b04549c7.7fcce8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":507,"y":100,"wires":[[]]},{"id":"9a463435.9a97b8","type":"inject","z":"b04549c7.7fcce8","name":"","topic":"BoM","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":false,"x":99,"y":75,"wires":[["420020a4.7eaf7"]]},{"id":"420020a4.7eaf7","type":"ftp in","z":"b04549c7.7fcce8","ftp":"617678.b507e988","operation":"get","filename":"","localFilename":"","name":"","x":328,"y":92,"wires":[["52436c9f.c3ce04"]]},{"id":"545c1161.092a9","type":"feedparse","z":"c062f1c4.9c61","name":"","url":"https://data.emergency.vic.gov.au/Show?pageId=getCapWarningRSS","interval":"10","x":283,"y":145,"wires":[["fd16ef24.fd717","5cc0e22d.95651c"]]},{"id":"a4b7e46c.884888","type":"json","z":"cc93ff07.e64b2","name":"","pretty":false,"x":727,"y":79,"wires":[["5e6fce38.36e86"]]},{"id":"32a70fd6.21d99","type":"debug","z":"cc93ff07.e64b2","name":"","active":false,"console":"false","complete":"payload","x":1172,"y":367,"wires":[]},{"id":"6a92eeb4.c98fd","type":"http request","z":"cc93ff07.e64b2","name":"Incidents & Planned Burns (CFA, MFB, DEPI)","method":"GET","ret":"txt","url":"https://data.emergency.vic.gov.au/Show?pageId=getIncidentJSON","tls":"","x":470,"y":73,"wires":[["a4b7e46c.884888"]]},{"id":"24c61bd7.3c0a04","type":"inject","z":"cc93ff07.e64b2","name":"","topic":"Watcher","payload":"","payloadType":"date","repeat":"60","crontab":"","once":true,"x":153,"y":69,"wires":[["6a92eeb4.c98fd"]]},{"id":"42823593.f848fc","type":"function","z":"96f4fbb4.ccf1f8","name":"","func":"\nreturn msg;","outputs":1,"noerr":0,"x":551,"y":88,"wires":[[]]},{"id":"875c5f2b.5fe","type":"inject","z":"96f4fbb4.ccf1f8","name":"","topic":"MODIS","payload":"","payloadType":"date","repeat":"3600","crontab":"","once":false,"x":148,"y":71,"wires":[["d774c11a.94f0a"]]},{"id":"d774c11a.94f0a","type":"ftp in","z":"96f4fbb4.ccf1f8","ftp":"617678.b507e988","operation":"get","filename":"1","localFilename":"","name":"","x":343,"y":78,"wires":[["42823593.f848fc"]]},{"id":"5e6fce38.36e86","type":"function","z":"cc93ff07.e64b2","name":"Split to incidents","func":"for(i=0;i<msg.payload.results.length;i++) {\n    \n    var newMsg = {};\n    newMsg.payload = {};\n    newMsg.payload.incidentNo = msg.payload.results[i].incidentNo;\n    newMsg.doc = msg.payload.results[i];\n    node.send(newMsg);\n}\nreturn;","outputs":1,"noerr":0,"x":643,"y":146,"wires":[["23d74ef3.95a012"]]},{"id":"df343111.551f3","type":"mongodb2 in","z":"cc93ff07.e64b2","service":"_ext_","configNode":"671e12d5.6bd4fc","name":"","collection":"incidents","operation":"findOneAndUpdate","x":775,"y":273,"wires":[["ab94cbf0.dfb088"]]},{"id":"fd16ef24.fd717","type":"debug","z":"c062f1c4.9c61","name":"","active":false,"console":"false","complete":"true","x":738,"y":130,"wires":[]},{"id":"dcd4e015.a4c32","type":"http in","z":"a9caf749.eb5048","name":"","url":"/models","method":"get","upload":false,"swaggerDoc":"","x":139,"y":261,"wires":[["65f5aa20.d97954"]]},{"id":"85cf55a0.d7ff88","type":"http response","z":"a9caf749.eb5048","name":"","statusCode":"","headers":{},"x":1175,"y":365,"wires":[]},{"id":"89a6b072.29f9a","type":"debug","z":"a9caf749.eb5048","name":"","active":true,"console":"false","complete":"false","x":1172,"y":319,"wires":[]},{"id":"ccd4554e.fc87a8","type":"json","z":"a9caf749.eb5048","name":"","pretty":true,"x":962,"y":364,"wires":[["85cf55a0.d7ff88","89a6b072.29f9a"]]},{"id":"1722bc97.40aaa3","type":"mongodb2 in","z":"a9caf749.eb5048","service":"_ext_","configNode":"671e12d5.6bd4fc","name":"","collection":"models","operation":"insertOne","x":798,"y":812,"wires":[["2aaf52da.0ca7ae"]]},{"id":"68d67bcb.62e0a4","type":"inject","z":"a9caf749.eb5048","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":114,"y":807,"wires":[["828005e3.3cd768"]]},{"id":"828005e3.3cd768","type":"template","z":"a9caf749.eb5048","name":"Single Model","field":"payload","fieldType":"msg","format":"json","syntax":"plain","template":"{\"type\":\"model\",\"rating\":\"8\",\"name\":\"Nolan et al.\",\"date\":\"9 September 2015\",\"title\":\"Predicting dead fine fuel moisture at regional scales using vapour pressure deficit from MODIS and gridded weather data\",\"href\":\"http://dx.doi.org/10.1016/j.rse.2015.12.010\",\"version\":\"1.0\",\"validated\":{\"validated\":true,\"references\":[{\"href\":\"\",\"authors\":\"Rachael H. Nolan, Víctor Resco de Dios, Matthias M. Boer, Gabriele Caccamo, Michael L. Goulden, Ross A. Bradstock\",\"date\":\"\"}]},\"description\":{\"date\":\"\",\"abstract\":\"Spatially explicit predictions of fuel moisture content are crucial for quantifying fire danger indices and as inputs to fire behaviour models. Remotely sensed predictions of fuel moisture have typically focused on live fuels; but regional estimates of dead fuel moisture have been less common. Here we develop and test the spatial application of a recently developed dead fuel moisture model, which is based on the exponential decline of fine fuel moisture with increasing vapour pressure deficit (D). We first compare the performance of two existing approaches to pre- dict D from satellite observations. We then use remotely sensed D, as well as D estimated from gridded daily weather observations, to predict dead fuel moisture. We calibrate and test the model at a woodland site in South East Australia, and then test the model at a range of sites in South East Australia and Southern California that vary in vegetation type, mean annual precipitation (129–1404 mm year −1 ) and leaf area index (0.1–5.7). We found that D modelled from remotely sensed land surface temperature performed slightly better than a model which also included total precipitable water (MAE b 1.16 kPa and 1.62 kPa respectively). D calculated with observations from the Moderate Resolution Imaging Spectroradiometer (MODIS) on the Terra satellite was under-predicted in areas with low leaf area index. Both D from remotely sensed data and gridded weather station data were good predictors of the moisture content of dead suspended fuels at validation sites, with mean absolute errors less than 3.9% and 6.0% respectively. The occurrence of data gaps in remotely sensed time series presents an obstacle to this approach, and assimilated or extrapolated meteorological observations may offer better continuity.\",\"range\":{},\"fuel\":{},\"metric\":\"\",\"index\":\"\",\"resolutions\":{\"minimum\":{\"spatial\":{\"value\":\"\",\"units\":\"\"},\"temporal\":{\"value\":\"24\",\"units\":\"hour\"}},\"optimum\":{\"spatial\":{\"value\":\"9\",\"units\":\"km^2\"},\"temporal\":{\"value\":\"\",\"units\":\"\"}},\"maximum\":{\"spatial\":{\"value\":\"\",\"units\":\"\"},\"temporal\":{\"value\":\"\",\"units\":\"\"}}},\"keywords\":{\"strengths\":[\"test\"],\"weaknesses\":[]},\"cavaets\":\"\"},\"datasources\":[\"MODIS\",\"GW\"]}","output":"json","x":310,"y":810,"wires":[["1722bc97.40aaa3"]]},{"id":"2aaf52da.0ca7ae","type":"debug","z":"a9caf749.eb5048","name":"","active":false,"console":"false","complete":"false","x":1121,"y":850,"wires":[]},{"id":"f13a5619.d820e8","type":"mongodb2 in","z":"a9caf749.eb5048","service":"_ext_","configNode":"671e12d5.6bd4fc","name":"","collection":"models","operation":"","x":654,"y":361,"wires":[["ccd4554e.fc87a8"]]},{"id":"65f5aa20.d97954","type":"function","z":"a9caf749.eb5048","name":"","func":"msg.operation = \"aggregate.toArray\";\nreturn msg;","outputs":1,"noerr":0,"x":362,"y":290,"wires":[["f13a5619.d820e8"]]},{"id":"9a1bb438.b1bcf8","type":"inject","z":"a9caf749.eb5048","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":122,"y":324,"wires":[["65f5aa20.d97954"]]},{"id":"54cf7817.b810a8","type":"http response","z":"a9caf749.eb5048","name":"","statusCode":"","headers":{},"x":825,"y":46,"wires":[]},{"id":"1306e523.f89d1b","type":"http in","z":"a9caf749.eb5048","name":"","url":"/windchange","method":"get","upload":false,"swaggerDoc":"","x":165,"y":51,"wires":[["e40a5a1c.23e518"]]},{"id":"e40a5a1c.23e518","type":"dropbox","z":"a9caf749.eb5048","dropbox":"17e2e8ac.896147","filename":"windchange.kmz","name":"","x":503,"y":53,"wires":[["54cf7817.b810a8"]]},{"id":"8f091de2.628ed","type":"mongodb2 in","z":"a9caf749.eb5048","service":"_ext_","configNode":"671e12d5.6bd4fc","name":"","collection":"datasources","operation":"insertOne","x":811,"y":905,"wires":[["2aaf52da.0ca7ae"]]},{"id":"65af3eb8.bcb7d","type":"template","z":"a9caf749.eb5048","name":"New Datasource","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"last_updated\":\"{{msg.timestamp}}\",\n    \"name\":\"KBDI\",\n    \"desc\":\"Keech-Byram Drought Index\",\n    \"provider_org\":\"bom.gov.au\",\n    \"frequency\": {\n        \"value\":\"24\",\n        \"units\":\"hours\"\n    },\n    \"provides\":[]\n}","output":"json","x":345,"y":901,"wires":[["8f091de2.628ed"]]},{"id":"263c57fb.7421f8","type":"inject","z":"a9caf749.eb5048","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":108,"y":895,"wires":[["65af3eb8.bcb7d"]]},{"id":"cf43a287.67709","type":"function","z":"a9caf749.eb5048","name":"","func":"msg.operation = \"find.toArray\";\nmsg.payload = {\"models\": msg.req.query.name};\nreturn msg;","outputs":1,"noerr":0,"x":394,"y":547,"wires":[["23e4b18c.dd151e"]]},{"id":"3fe74805.d9caa8","type":"http in","z":"a9caf749.eb5048","name":"","url":"/model/datasources","method":"get","upload":false,"swaggerDoc":"","x":153,"y":512,"wires":[["cf43a287.67709"]]},{"id":"70083c33.097f94","type":"inject","z":"a9caf749.eb5048","name":"","topic":"","payload":"{\"models\":\"Boer\"}","payloadType":"json","repeat":"","crontab":"","once":false,"x":140,"y":587,"wires":[["cf43a287.67709"]]},{"id":"1e66111f.b9139f","type":"http response","z":"a9caf749.eb5048","name":"","statusCode":"","headers":{},"x":1390,"y":505,"wires":[]},{"id":"9f34a62c.c4a978","type":"debug","z":"a9caf749.eb5048","name":"","active":true,"console":"false","complete":"false","x":1393,"y":444,"wires":[]},{"id":"83e9c1f8.a234f","type":"json","z":"a9caf749.eb5048","name":"","pretty":true,"x":1209,"y":474,"wires":[["1e66111f.b9139f","9f34a62c.c4a978"]]},{"id":"23e4b18c.dd151e","type":"mongodb2 in","z":"a9caf749.eb5048","service":"_ext_","configNode":"671e12d5.6bd4fc","name":"","collection":"datasources","operation":"find.toArray","x":746,"y":560,"wires":[["83e9c1f8.a234f"]]},{"id":"a9e18e12.0784c","type":"http in","z":"a9caf749.eb5048","name":"","url":"/model","method":"get","upload":false,"swaggerDoc":"","x":122,"y":384,"wires":[["7a509ad9.f84b04"]]},{"id":"7a509ad9.f84b04","type":"function","z":"a9caf749.eb5048","name":"","func":"msg.operation = \"findOne\";\nmsg.payload = {\"name\": msg.req.query.name};\nreturn msg;","outputs":1,"noerr":0,"x":375,"y":380,"wires":[["f13a5619.d820e8"]]},{"id":"23c1e8db.75ae48","type":"inject","z":"a9caf749.eb5048","name":"","topic":"","payload":"{\"name\":\"Boer\"}","payloadType":"json","repeat":"","crontab":"","once":false,"x":143,"y":437,"wires":[["7a509ad9.f84b04"]]},{"id":"ab94cbf0.dfb088","type":"debug","z":"cc93ff07.e64b2","name":"","active":false,"console":"false","complete":"payload.lastErrorObject","x":1134,"y":273,"wires":[]},{"id":"6549a3ca.701c1c","type":"function","z":"164e0840.391e68","name":"build operation parameters: filter, update","func":"var filter = msg.payload;\nif (\"string\" == typeof filter) {\n  filter = JSON.parse(filter);\n}\n\nmsg.payload = [\n  filter,\n  {\n    \"$inc\": {\n      \"counter\": 1\n    }\n  }\n];\n\nreturn msg;\n","outputs":1,"x":346,"y":230.22219848632812,"wires":[["6b33a715.f20728"]]},{"id":"6b33a715.f20728","type":"mongodb2 in","z":"164e0840.391e68","service":"_ext_","configNode":"","name":"","collection":"mycollection","operation":"findOneAndUpdate","x":452.3333435058594,"y":159,"wires":[["143d598c.dc8176"]]},{"id":"19133220.9313ce","type":"inject","z":"164e0840.391e68","name":"Inject filter","topic":"","payload":"{\"_id\":\"mydocument\"}","payloadType":"str","repeat":"","crontab":"","once":false,"x":111.5,"y":230.22219848632812,"wires":[["6549a3ca.701c1c"]]},{"id":"143d598c.dc8176","type":"debug","z":"164e0840.391e68","name":"","active":true,"console":"false","complete":"false","x":686,"y":231.22219848632812,"wires":[]},{"id":"23d74ef3.95a012","type":"function","z":"cc93ff07.e64b2","name":"build operation parameters: filter, update","func":"var filter = msg.payload;\nif (\"string\" == typeof filter) {\n  filter = JSON.parse(filter);\n}\n\nmsg.payload = [\n  filter,\n  {\n    \"$inc\": {\n      \"counter\": 1\n    },\n    \"$set\": msg.doc\n  },\n  {\n      \"upsert\": true\n  }\n];\n\nreturn msg;\n","outputs":1,"noerr":0,"x":749,"y":209,"wires":[["df343111.551f3"]]},{"id":"c2280353.ae6b","type":"http in","z":"cc93ff07.e64b2","name":"","url":"/fires","method":"get","upload":false,"swaggerDoc":"","x":115,"y":356,"wires":[["55e052c0.e1344c"]]},{"id":"e75be8b.f129518","type":"http response","z":"cc93ff07.e64b2","name":"","statusCode":"","headers":{},"x":1528,"y":445,"wires":[]},{"id":"b977027e.42746","type":"mongodb2 in","z":"cc93ff07.e64b2","service":"_ext_","configNode":"671e12d5.6bd4fc","name":"","collection":"incidents","operation":"find.toArray","x":645,"y":433,"wires":[["32a70fd6.21d99","39faf71.5189508"]]},{"id":"55e052c0.e1344c","type":"function","z":"cc93ff07.e64b2","name":"","func":"var ts = +new Date();\nvar tminus24 = ts - (24 * 60 * 60 * 1000);\n\nvar map={\"category1\":\"Fire\", \"eventCode\": {$ne:\"False Alarm\"},\"lastUpdatedDt\": {$gte: tminus24}};\nvar reduce = {};\nvar options = {};\n\nmsg.payload = [\n  map,\n  reduce,\n  options\n];\n\nreturn msg;","outputs":1,"noerr":0,"x":297,"y":356,"wires":[["b977027e.42746"]]},{"id":"84214777.894ee8","type":"http in","z":"cc93ff07.e64b2","name":"","url":"/bushfires","method":"get","upload":false,"swaggerDoc":"","x":140,"y":433,"wires":[["629f9bf4.3a0ea4"]]},{"id":"629f9bf4.3a0ea4","type":"function","z":"cc93ff07.e64b2","name":"","func":"var ts = +new Date();\n\nvar tminus24 = ts - (24 * 60 * 60 * 1000);\nvar map={\"category2\":\"Bushfire\", \"eventCode\": {$ne:\"False Alarm\"},\"lastUpdatedDt\": {$gte: tminus24}};\nvar reduce = {};\nvar options = {};\n\nmsg.payload = [\n  map,\n  reduce,\n  options\n];\n\nreturn msg;","outputs":1,"noerr":0,"x":302,"y":433,"wires":[["b977027e.42746"]]},{"id":"9306951e.2e9ad8","type":"http in","z":"cc93ff07.e64b2","name":"","url":"/safe","method":"get","upload":false,"swaggerDoc":"","x":116,"y":512,"wires":[["cc659c9b.fa70c"]]},{"id":"cc659c9b.fa70c","type":"function","z":"cc93ff07.e64b2","name":"","func":"var map={\"originStatus\":\"SAFE\"};\nvar reduce = {\"eventCode\": {$ne:\"False Alarm\"}};\nvar options = {};\n\nmsg.payload = [\n  map,\n  reduce,\n  options\n];\n\nreturn msg;","outputs":1,"noerr":0,"x":298,"y":512,"wires":[["b977027e.42746"]]},{"id":"81f467a8.aaf4b8","type":"json","z":"cc93ff07.e64b2","name":"","pretty":false,"x":1363,"y":449,"wires":[["e75be8b.f129518","ed89098f.1781b8"]]},{"id":"ed89098f.1781b8","type":"debug","z":"cc93ff07.e64b2","name":"","active":false,"console":"false","complete":"false","x":1553,"y":496,"wires":[]},{"id":"4aa683f6.3e6f4c","type":"inject","z":"cc93ff07.e64b2","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":72,"y":322,"wires":[["55e052c0.e1344c"]]},{"id":"39faf71.5189508","type":"function","z":"cc93ff07.e64b2","name":"GeoJSON Encode as FeatureCollection","func":"var coll = {};\ncoll.type = \"FeatureCollection\";\ncoll.features = [];\n\nfor(i=0;i<msg.payload.length;i++) {\n    wf = {}\n    wfp = msg.payload[i];\n    wf.type = \"Feature\";\n    wf.geometry = {};\n    wf.geometry.type = \"Point\";\n    wf.geometry.coordinates = [wfp.longitude,wfp.latitude];\n    wf.properties = wfp;\n    coll.features.push(wf);\n}\nmsg.payload = coll;\nreturn msg;","outputs":1,"noerr":0,"x":1087,"y":462,"wires":[["81f467a8.aaf4b8"]]},{"id":"7f654a93.457174","type":"inject","z":"cc93ff07.e64b2","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":66,"y":489,"wires":[["cc659c9b.fa70c"]]},{"id":"ff16bc70.dd32a","type":"inject","z":"cc93ff07.e64b2","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":71,"y":405,"wires":[["629f9bf4.3a0ea4"]]},{"id":"7e28688d.c5c498","type":"function","z":"c062f1c4.9c61","name":"build operation parameters: filter, update","func":"var filter = msg.payload;\nif (\"string\" == typeof filter) {\n  filter = JSON.parse(filter);\n}\n\nmsg.payload = [\n  filter,\n  {\n    \"$inc\": {\n      \"counter\": 1\n    },\n    \"$set\": msg.article\n  },\n  {\n      \"upsert\": true\n  }\n];\n\nreturn msg;\n","outputs":1,"noerr":0,"x":377,"y":352,"wires":[["247a48bd.e4e748"]]},{"id":"247a48bd.e4e748","type":"mongodb2 in","z":"c062f1c4.9c61","service":"_ext_","configNode":"671e12d5.6bd4fc","name":"","collection":"warnings","operation":"findOneAndUpdate","x":450,"y":466,"wires":[["53446b3e.5ac9e4"]]},{"id":"53446b3e.5ac9e4","type":"debug","z":"c062f1c4.9c61","name":"","active":false,"console":"false","complete":"payload.lastErrorObject","x":809,"y":466,"wires":[]},{"id":"5cc0e22d.95651c","type":"function","z":"c062f1c4.9c61","name":"","func":"msg.message = msg.payload;\nmsg.payload = {\"topic\": msg.topic, \"message\": msg.message};\nreturn msg;","outputs":1,"noerr":0,"x":388,"y":254,"wires":[["7e28688d.c5c498"]]},{"id":"6a915ef3.de6c5","type":"mongodb2 in","z":"cc93ff07.e64b2","service":"_ext_","configNode":"671e12d5.6bd4fc","name":"","collection":"warnings","operation":"find.toArray","x":650,"y":623,"wires":[["4277dc5c.fc79f4"]]},{"id":"4277dc5c.fc79f4","type":"function","z":"cc93ff07.e64b2","name":"GeoJSON Encode as FeatureCollection","func":"var coll = {};\ncoll.type = \"FeatureCollection\";\ncoll.features = [];\n\nfor(i=0;i<msg.payload.length;i++) {\n    wf = {}\n    wfp = msg.payload[i];\n    wf.type = \"Feature\";\n    wf.geometry = {};\n    wf.geometry.type = \"Point\";\n    wf.geometry.coordinates = [wfp.longitude,wfp.latitude];\n    wf.properties = wfp;\n    coll.features.push(wf);\n}\nmsg.payload = coll;\nreturn msg;","outputs":1,"noerr":0,"x":1095,"y":644,"wires":[["3978ad84.e93ad2"]]},{"id":"c3abb1fd.4e3d","type":"http response","z":"cc93ff07.e64b2","name":"","statusCode":"","headers":{},"x":1543,"y":630,"wires":[]},{"id":"3978ad84.e93ad2","type":"json","z":"cc93ff07.e64b2","name":"","pretty":false,"x":1378,"y":634,"wires":[["c3abb1fd.4e3d","bb926488.0d0e38"]]},{"id":"bb926488.0d0e38","type":"debug","z":"cc93ff07.e64b2","name":"","active":false,"console":"false","complete":"false","x":1568,"y":681,"wires":[]},{"id":"b4c75dc9.22a35","type":"http in","z":"cc93ff07.e64b2","name":"","url":"/warnings","method":"get","upload":false,"swaggerDoc":"","x":99,"y":638,"wires":[["d10d53a0.19478"]]},{"id":"d10d53a0.19478","type":"function","z":"cc93ff07.e64b2","name":"","func":"var ts = +new Date();\nvar tminus24 = ts - (24 * 60 * 60 * 1000);\n\nvar map={\"topic\":\"http://emergency.vic.gov.au/\", \"date\": {$gte: tminus24}};\nvar reduce = {};\nvar options = {};\n\nmsg.payload = [\n  map,\n  reduce,\n  options\n];\n\nreturn msg;","outputs":1,"noerr":0,"x":303,"y":627,"wires":[["6a915ef3.de6c5"]]},{"id":"74041943.22c288","type":"inject","z":"cc93ff07.e64b2","name":"","topic":"","payload":"","payloadType":"date","repeat":"","crontab":"","once":false,"x":78,"y":593,"wires":[["d10d53a0.19478"]]}]